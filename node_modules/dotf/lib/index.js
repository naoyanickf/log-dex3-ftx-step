"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const graceful_fs_1 = require("graceful-fs");
const jsonfile_1 = require("jsonfile");
const os_1 = require("os");
const path_1 = require("path");
const { access, chmod, unlink } = graceful_fs_1.promises;
/**
 * Delete, Read, Write, or Exist Dotfiles
 *
 * @param {__dirname} dirname The relative dirname
 * @param {string} name The dotfile name
 * @return {Dotfile} `delete`, `exists`, `read` and `write` Promises
 */
const dotf = (dirname, name) => {
    if (!name || !dirname) {
        throw new Error('Both name and dirname parameters are required');
    }
    if (dirname.startsWith('~')) {
        dirname = os_1.homedir();
    }
    const fullpath = path_1.join(dirname, `.${name}`);
    return {
        delete: async () => unlink(fullpath),
        exists: async () => {
            try {
                await access(fullpath);
                return true;
            }
            catch (_a) {
                return false;
            }
        },
        read: async () => jsonfile_1.readFile(fullpath),
        write: process.platform === 'win32'
            ? // If a platform is not Windows(include x64)
                async (object) => {
                    await jsonfile_1.writeFile(fullpath, object);
                    return object;
                }
            : async (object) => {
                await jsonfile_1.writeFile(fullpath, object);
                // Same as chmod 600
                await chmod(fullpath, graceful_fs_1.constants.S_IRUSR | graceful_fs_1.constants.S_IWUSR);
                return object;
            },
    };
};
exports.default = dotf;
// For CommonJS default export support
module.exports = dotf;
Object.defineProperty(module.exports, 'default', { enumerable: false, value: dotf });
//# sourceMappingURL=index.js.map